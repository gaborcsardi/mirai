---
title: "mirai - Parallel Integration"
vignette: >
  %\VignetteIndexEntry{mirai - Parallel Integration}
  %\VignetteEngine{knitr::knitr}
  %\VignetteEncoding{UTF-8}
---



### Parallel Integration

`mirai` provides an (experimental) alternative communications backend for R. This functionality was developed to fulfil a request by R Core at R Project Sprint 2023.

`make_cluster()` creates a cluster object of class 'miraiCluster', which may be used for any function in the `parallel` base package such as `parallel::clusterApply()`, `parallel::parLapply()` or the load-balanced version `parallel::parLapplyLB()`.

  + Specify 'n' to launch nodes on the local machine.
  + Specify 'url' for receiving connections from remote nodes.
  + Optionally, specify 'remote' to launch remote daemons using a remote configuration generated by `remote_config()` or `ssh_config()`.


```r
library(mirai)

cl <- make_cluster(4)
cl
#> < miraiCluster | ID: `0` nodes: 4 active: TRUE >

parallel::parLapply(cl, iris, mean)
#> $Sepal.Length
#> [1] 5.843333
#> 
#> $Sepal.Width
#> [1] 3.057333
#> 
#> $Petal.Length
#> [1] 3.758
#> 
#> $Petal.Width
#> [1] 1.199333
#> 
#> $Species
#> [1] NA
```

`status()` may be called on a 'miraiCluster` to query the number of connected nodes at any time.


```r
status(cl)
#> $connections
#> [1] 4
#> 
#> $daemons
#> [1] "abstract://9d3563c19de6181b72e407a5"

stop_cluster(cl)
```
Specifying 'url' without 'remote' causes the shell commands for manual deployment of nodes to be printed to the console.


```r
cl <- make_cluster(n = 2, url = host_url())
#> Shell commands for deployment on nodes:
#> 
#> [1]
#> Rscript -e "mirai::daemon('tcp://hostname:37197',rs=c(10407,872660769,-1764378002,1577836567,-906322580,354061181,-892072934))"
#> 
#> [2]
#> Rscript -e "mirai::daemon('tcp://hostname:37197',rs=c(10407,1038611314,2079194929,-852266189,494315566,1464442287,-73856997))"

stop_cluster(cl)
```

Created clusters are fully compatible with `parallel` cluster types.

They may be registered by package [`doParallel`](https://cran.r-project.org/package=doParallel) for use with the [`foreach`](https://cran.r-project.org/package=foreach) package.
